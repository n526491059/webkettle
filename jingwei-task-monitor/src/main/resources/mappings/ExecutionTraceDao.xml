<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.sxdata.jingwei.dao.ExecutionTraceDao">

    <insert id="addExecutionTrace" parameterType="org.flhy.ext.Task.ExecutionTraceEntity">
      INSERT INTO task_execution_log
      (jobName,startTime,endTime,execMethod,status,executionConfiguration,executionLog,type)
      VALUES (#{jobName},#{startTime},#{endTime},#{execMethod},#{status},#{executionConfiguration},#{executionLog},#{type})
    </insert>

    <select id="getAllLogByPage" resultType="org.flhy.ext.Task.ExecutionTraceEntity">
      select
        e.fireId as fireId,
        e.jobName as jobName,
        e.startTime as startTime,
        e.endTime as endTime,
        e.execMethod as execMethod,
        e.`status` as status,
        e.executionConfiguration as executionConfiguration,
        e.executionLog as executionLog,
         e.type as type
      from task_execution_log e WHERE 1=1
        <if test='param3!=null and param3!=""'>
            and e.status = #{2}
        </if>
        <if test='param4!=null and param4!=""'>
            and e.type = #{3}
        </if>
        <if test='param5!=null and param5!=""'  >
            and e.startTime >= #{4}
        </if>
        <if test='param6!=null and param6!=""'>
            and e.jobName = #{5}
        </if>
      limit #{0},#{1}
    </select>

    <select id="getAllLogCount" resultType="java.lang.Integer">
      SELECT  COUNT(1) FROM task_execution_log e
    </select>

    <select id="getTraceById" resultType="org.flhy.ext.Task.ExecutionTraceEntity">
        select
        e.fireId as fireId,
        e.jobName as jobName,
        e.startTime as startTime,
        e.endTime as endTime,
        e.execMethod as execMethod,
        e.`status` as status,
        e.executionConfiguration as executionConfiguration,
        e.executionLog as executionLog,
        e.type as type
        from task_execution_log e WHERE e.fireId=#{id}
    </select>

</mapper>